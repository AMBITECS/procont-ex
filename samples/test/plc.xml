<?xml version='1.0' encoding='utf-8'?>
<project xmlns="http://www.plcopen.org/xml/tc6_0201" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ns1="http://www.plcopen.org/xml/tc6_0201">
  <fileHeader companyName="Неизвестно" productName="Unnamed" productVersion="1" creationDateTime="2025-01-15T16:56:00"/>
  <contentHeader name="test" modificationDateTime="2025-01-16T04:38:44">
    <coordinateInfo>
      <fbd>
        <scaling x="10" y="10"/>
      </fbd>
      <ld>
        <scaling x="10" y="10"/>
      </ld>
      <sfc>
        <scaling x="10" y="10"/>
      </sfc>
    </coordinateInfo>
  </contentHeader>
  <types>
    <dataTypes>
      <dataType name="TError">
        <baseType>
          <enum>
            <values>
              <value name="E_SUCCESS"/>
              <value name="E_ID"/>
              <value name="E_HEAD"/>
              <value name="E_INDEX"/>
              <value name="E_ITEMPOS"/>
              <value name="E_ITEM"/>
              <value name="E_GRID"/>
              <value name="E_AXIS"/>
              <value name="E_PRIO"/>
              <value name="E_MATER"/>
              <value name="E_PROFILE"/>
              <value name="E_VALUE"/>
              <value name="E_STACKSIZE"/>
              <value name="E_ROOT"/>
              <value name="E_ITEMSIZE"/>
              <value name="E_STEPSIZE"/>
              <value name="E_TIMESIZE"/>
              <value name="E_NOTREADY"/>
              <value name="E_STRUCT"/>
              <value name="E_VALIDATE"/>
              <value name="E_LOC2ABS"/>
              <value name="E_ABS2LOC"/>
              <value name="E_GETTEMP"/>
              <value name="E_SETTEMP"/>
              <value name="E_CHECKVALID"/>
              <value name="E_LINKITEMS"/>
              <value name="E_PROCESS"/>
              <value name="E_PREPROC"/>
              <value name="E_POSTPROC"/>
              <value name="E_BADTEMP"/>
              <value name="E_STATE"/>
              <value name="E_CHECK"/>
              <value name="E_FAIL"/>
              <value name="W_PERIOD"/>
            </values>
          </enum>
        </baseType>
        <initialValue>
          <simpleValue value="E_SUCCESS"/>
        </initialValue>
      </dataType>
      <dataType name="TStat">
        <baseType>
          <struct>
            <variable name="RDY">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="TRUE"/>
              </initialValue>
            </variable>
            <variable name="DBG">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="TRUE"/>
              </initialValue>
            </variable>
            <variable name="ERR">
              <type>
                <derived name="TError"/>
              </type>
              <initialValue>
                <simpleValue value="E_SUCCESS"/>
              </initialValue>
            </variable>
            <variable name="PAR">
              <type>
                <UINT/>
              </type>
              <initialValue>
                <simpleValue value="0"/>
              </initialValue>
            </variable>
            <variable name="STR">
              <type>
                <string/>
              </type>
              <initialValue>
                <simpleValue value="''"/>
              </initialValue>
            </variable>
          </struct>
        </baseType>
      </dataType>
      <dataType name="LOGLEVEL">
        <baseType>
          <enum>
            <values>
              <value name="CRITICAL"/>
              <value name="WARNING"/>
              <value name="INFO"/>
              <value name="DEBUG"/>
            </values>
          </enum>
        </baseType>
        <initialValue>
          <simpleValue value="DEBUG"/>
        </initialValue>
      </dataType>
    </dataTypes>
    <pous>
      <pou name="Err2Lev" pouType="function">
        <interface>
          <returnType>
            <derived name="LOGLEVEL"/>
          </returnType>
          <inputVars>
            <variable name="Err">
              <type>
                <derived name="TError"/>
              </type>
              <initialValue>
                <simpleValue value="E_SUCCESS"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Флаг ошибки]]></xhtml:p>
              </documentation>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[CASE Err OF
E_SUCCESS:  
  Err2Lev:=INFO;  
W_PERIOD:   
  Err2Lev:=WARNING;  
ELSE        
  Err2Lev:=CRITICAL;  
END_CASE;
RETURN;]]></xhtml:p>
          </ST>
        </body>
        <documentation>
          <xhtml:p><![CDATA[Приоритет по коду ошибки]]></xhtml:p>
        </documentation>
      </pou>
      <pou name="MakeMsg" pouType="function">
        <interface>
          <returnType>
            <string/>
          </returnType>
          <inputVars>
            <variable name="S0">
              <type>
                <string/>
              </type>
              <initialValue>
                <simpleValue value="''"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Строка 0]]></xhtml:p>
              </documentation>
            </variable>
            <variable name="S1">
              <type>
                <string/>
              </type>
              <initialValue>
                <simpleValue value="''"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Строка 1]]></xhtml:p>
              </documentation>
            </variable>
            <variable name="S2">
              <type>
                <string/>
              </type>
              <initialValue>
                <simpleValue value="''"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Строка 2]]></xhtml:p>
              </documentation>
            </variable>
            <variable name="S3">
              <type>
                <string/>
              </type>
              <initialValue>
                <simpleValue value="''"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Строка 3]]></xhtml:p>
              </documentation>
            </variable>
          </inputVars>
          <localVars>
            <variable name="BLOG">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Флаг работы]]></xhtml:p>
              </documentation>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[{{ BLOG = __GET_GLOBAL_STAT()->DBG; }}
if (BLOG) then 
  MakeMsg:=concat(concat(concat(S0, S1), S2), S3); 
else 
  MakeMsg:=''; 
end_if;]]></xhtml:p>
          </ST>
        </body>
        <documentation>
          <xhtml:p><![CDATA[Выдает строку по коду ошибки]]></xhtml:p>
        </documentation>
      </pou>
      <pou name="Err2Str" pouType="function">
        <interface>
          <returnType>
            <string/>
          </returnType>
          <inputVars>
            <variable name="ERR">
              <type>
                <derived name="TError"/>
              </type>
              <initialValue>
                <simpleValue value="E_SUCCESS"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Код ошибки]]></xhtml:p>
              </documentation>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[case ERR of
(* Информационные сообщения *)
E_SUCCESS:      Err2Str := 'Succeeded!';

(* Критические ошибки *)
E_FAIL:         Err2Str := 'Unexpected error';
E_STATE:        Err2Str := 'Program state error';
E_CHECK:        Err2Str := 'Check point error';
E_HEAD:         Err2Str := 'Invalid head';
E_INDEX:        Err2Str := 'Invalid index';
E_ITEMPOS:      Err2Str := 'Invalid item position';
E_ITEM:         Err2Str := 'Invalid element';
E_GRID:         Err2Str := 'Invalid grid';
E_AXIS:         Err2Str := 'Invalid axis';
E_PRIO:         Err2Str := 'Invalid prio';
E_MATER:        Err2Str := 'Invalid mater';
E_PROFILE:      Err2Str := 'Invalid profile';
E_VALUE:        Err2Str := 'Invalid value';
E_ROOT:         Err2Str := 'Invalid ROOT';
E_ITEMSIZE:     Err2Str := 'Bad ItemAt size';
E_STEPSIZE:     Err2Str := 'Bad axis step';
E_TIMESIZE:     Err2Str := 'Bad time step';
E_STACKSIZE:    Err2Str := 'Small stacksize';
E_NOTREADY:     Err2Str := 'Object dont ready';
E_LOC2ABS:      Err2Str := 'Loc2Abs error';
E_ABS2LOC:      Err2Str := 'Abs2Loc error';
E_VALIDATE:     Err2Str := 'Validate error';
E_CHECKVALID:   Err2Str := 'CheckValid error';
E_LINKITEMS:    Err2Str := 'LinkItems error';
E_PROCESS:      Err2Str := 'Process item error';
E_BADTEMP:      Err2Str := 'GetTemp error';

(* Предупреждения *)
W_PERIOD:       Err2Str := 'Small period';
else            Err2Str := 'Unknown error';
end_case;
]]></xhtml:p>
          </ST>
        </body>
        <documentation>
          <xhtml:p><![CDATA[Выдает строку по коду ошибки]]></xhtml:p>
        </documentation>
      </pou>
      <pou name="LogMsg" pouType="function">
        <interface>
          <returnType>
            <string/>
          </returnType>
          <inputVars>
            <variable name="STR">
              <type>
                <string/>
              </type>
              <initialValue>
                <simpleValue value="''"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Строка для протокола]]></xhtml:p>
              </documentation>
            </variable>
            <variable name="LVL">
              <type>
                <derived name="LOGLEVEL"/>
              </type>
              <initialValue>
                <simpleValue value="DEBUG"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Уровень сообщения (по умолчанию - Debug)]]></xhtml:p>
              </documentation>
            </variable>
            <variable name="ERR">
              <type>
                <derived name="TError"/>
              </type>
              <initialValue>
                <simpleValue value="E_SUCCESS"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[Код ошибки]]></xhtml:p>
              </documentation>
            </variable>
          </inputVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[{{
  #ifdef _BEREMIZ_H_
    #define __LOG_MSG(level,string,length) LogMessage(level,(char *)string,length)
  #else
    #define __LOG_MSG(level,string,length) printf("%s\n", (char *)string)
  #endif
  TSTAT *pStat = __GET_GLOBAL_STAT();
  if (LVL!=LOGLEVEL__DEBUG || (LVL==LOGLEVEL__DEBUG && pStat->DBG)) {
    if (STR.len) __LOG_MSG(LVL, (char *)STR.body, STR.len);
  }
  if (ERR!=TERROR__E_SUCCESS) {
    pStat->ERR=ERR;
    LVL=ERR2LEV(1,NULL,ERR); 
    STR=ERR2STR(1,NULL,ERR);
    if (STR.len) __LOG_MSG(LVL,(char *)STR.body,STR.len);
  }
  return (LOGMSG = __INIT_STRING);
}}
]]></xhtml:p>
          </ST>
        </body>
        <documentation>
          <xhtml:p><![CDATA[Протоколирование ошибки]]></xhtml:p>
        </documentation>
      </pou>
      <pou name="Test" pouType="program">
        <interface>
          <localVars>
            <variable name="LocalVar0">
              <type>
                <DINT/>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[
LocalVar0 := 1;
]]></xhtml:p>
          </ST>
        </body>
      </pou>
      <pou name="Simulation" pouType="program">
        <interface>
          <localVars>
            <variable name="T1">
              <type>
                <derived name="TON"/>
              </type>
            </variable>
            <variable name="P_Cooling">
              <type>
                <TIME/>
              </type>
              <initialValue>
                <simpleValue value="TIME#500ms"/>
              </initialValue>
            </variable>
            <variable name="xReduceTemp">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="T2">
              <type>
                <derived name="TON"/>
              </type>
            </variable>
            <variable name="P_Environment">
              <type>
                <TIME/>
              </type>
              <initialValue>
                <simpleValue value="TIME#2s0ms"/>
              </initialValue>
            </variable>
            <variable name="P_EnvironmentDoorOpen">
              <type>
                <TIME/>
              </type>
              <initialValue>
                <simpleValue value="TIME#1s0ms"/>
              </initialValue>
            </variable>
            <variable name="xRaiseTemp">
              <type>
                <BOOL/>
              </type>
            </variable>
            <variable name="timTemp">
              <type>
                <TIME/>
              </type>
            </variable>
            <variable name="iCounter">
              <type>
                <INT/>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[iCounter:=0;
(*
    IF Glob_VAR.bCompressor THEN
      T1(IN:= Glob_Var.bCompressor, PT:= P_Cooling, Q=&gt;xReduceTemp);
    
      IF xReduceTemp THEN
        Glob_Var.rTempActual := Glob_Var.rTempActual-0.1;
        T1(IN:=FALSE);
      END_IF
    END_IF

    timTemp:=SEL(Glob_Var.rDoorOpen, P_Environment, P_EnvironmentDoorOpen);

    T2(IN:= TRUE, PT:= timTemp, Q=&gt;xRaiseTemp);
    
    IF xRaiseTemp THEN
      Glob_Var.rTempActual := Glob_Var.rTempActual + 0.1;
      T2(IN:=FALSE);
    END_IF
*)
]]></xhtml:p>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>7562cdf6-dbc4-4d40-84ef-4a5be22cb84c</ObjectId>
          </data>
        </addData>
      </pou>
    </pous>
  </types>
  <instances>
    <configurations>
      <configuration name="Config0">
        <resource name="Res0">
          <task name="MainTask" priority="0" interval="T#20ms">
            <pouInstance name="Prog1" typeName="Simulation"/>
            <pouInstance name="Prog2" typeName="Test"/>
          </task>
          <globalVars>
            <variable name="rTempActual">
              <type>
                <REAL/>
              </type>
              <initialValue>
                <simpleValue value="8"/>
              </initialValue>
            </variable>
            <variable name="rTempSet">
              <type>
                <REAL/>
              </type>
              <initialValue>
                <simpleValue value="8"/>
              </initialValue>
            </variable>
            <variable name="rDoorOpen">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="timAlarmThreshold">
              <type>
                <TIME/>
              </type>
              <initialValue>
                <simpleValue value="TIME#30ms"/>
              </initialValue>
            </variable>
            <variable name="rDoorOpenThreshold">
              <type>
                <TIME/>
              </type>
              <initialValue>
                <simpleValue value="TIME#10s0ms"/>
              </initialValue>
            </variable>
            <variable name="bCompressor">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="false"/>
              </initialValue>
            </variable>
            <variable name="bSignal">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
            <variable name="bLamp">
              <type>
                <BOOL/>
              </type>
              <initialValue>
                <simpleValue value="FALSE"/>
              </initialValue>
            </variable>
          </globalVars>
        </resource>
        <globalVars>
          <variable name="STAT">
            <type>
              <derived name="TStat"/>
            </type>
            <documentation>
              <xhtml:p><![CDATA[Статус контроллера]]></xhtml:p>
            </documentation>
          </variable>
        </globalVars>
      </configuration>
    </configurations>
  </instances>
</project>
